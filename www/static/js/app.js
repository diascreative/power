!function(){"use strict";var t=angular.module("turbine-directives",[]);t.directive("turbineStats",function(){return{restrict:"E",templateUrl:"./templates/turbine-stats.html"}}),t.directive("turbineAbout",function(){return{restrict:"A",templateUrl:"./templates/turbine-about.html"}})}(),function(){"use strict";var t=angular.module("winderful-filters",[]);t.filter("equivalent",["$filter",function(t){return function(e){var n=e>0?this.wattage/e:0;return t("number")(n,0)}}])}(),function(){"use strict";var t=angular.module("winderfulApp",["turbine-directives","winderful-filters","ngBootstrap","angular-rickshaw"]);t.controller("turbineController",["$scope","$http",function(t,e){function n(t,e){var n=moment.unix(t).format("Do MMMM YYYY")+" - "+moment.unix(e).format("Do MMMM YYYY"),a={hitType:"event",eventCategory:"dates",eventAction:"change",eventLabel:n};"undefined"!=typeof ga&&ga("send",a)}var a=!0;t.rotationSpeed=10,this.graph={},this.percentage=0,this.speed=0,t.wattage=0,this.displayDate=new Date,this.loaded=!1,this.hoverDeets={},this.iosSafari=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),this.usageExamples=[{action:"Powering",consumption:483e-6*264e5/100,object:"% of UK homes"},{action:"Or making",consumption:6e-5,object:"cups of tea"},{action:"Or making",consumption:33e-6,object:"slices of toast"},{action:"Or driving",consumption:38e-5,object:"miles in a Tesla Model S"},{action:"Or watching",consumption:55e-6,object:"hours of telly"},{action:"Or powering",consumption:5e-4,object:"fridge-freezers for a day"}],"undefined"!=typeof theme&&"undefined"!=typeof theme.usageExamples&&(this.usageExamples=theme.usageExamples),this.updateStats=function(e,n,a){o(n),t.wattage=n,this.displayDate=new Date(1e3*e),this.percentage=a,"undefined"!=typeof theme&&"undefined"!=typeof theme.onUpdate&&theme.onUpdate(n),this.isCurrent=(new Date-this.displayDate)/6e4<30,this.showExample=Math.round(Math.random()*(this.usageExamples.length-2))+1,this.iosSafari&&t.$apply()},this.setStats=function(){this.updateStats(this.hoverDeets.x,this.hoverDeets.y,this.hoverDeets.z)};var i=function(t,e,n,a,i,r){return this.hoverDeets.x=e,this.hoverDeets.y=n,this.hoverDeets.z=r.value.z,this.iosSafari&&this.setStats(),n+"MW"},r=function(){},o=function(e){var n=$("#turbine-rotor-container"),a=$("#turbine-rotor").eq(0),i=s(e),r=1.9*e,o=u(a.css("transform")),h=u(n.css("transform"));t.rotationSpeed=i,a.removeClass("animated").hide();var d=o+h+r;n.css("transform","rotateZ("+d+"deg)"),setTimeout(function(){a.addClass("animated").show()},0)},s=function(t){return t?6500/t:3e6},u=function(t){var e=0;if("none"!==t){var n=t.split("(")[1];n=n.split(")")[0],n=n.split(",");var a=n[0],i=n[1],r=Math.atan2(i,a);0>r&&(r+=2*Math.PI),e=Math.round(r*(180/Math.PI))}return e};this.graph.options={renderer:"area",height:200},this.graph.features={hover:{formatter:i.bind(this),xFormatter:function(e){var n=moment().format("X"),a="";return a=t.delta<=691200?n-e>518400?moment.unix(e).format("LLL"):moment.unix(e).calendar():t.delta<=2592e3?moment.unix(e).format("LLL"):t.delta<=31104e3?moment.unix(e).format("LL"):"week "+moment.unix(e).format("w")+" of "+moment.unix(e).format("YYYY")}},yAxis:{},xAxis:{timeFixture:new Rickshaw.Fixtures.Time.Local},complete:r.bind(this)},this.graph.series=[{name:"Wind",color:"#007232",data:[{x:0,y:0}]}],this.daterange={startDate:moment().subtract("days",7),endDate:moment()},t.loadInData=function(){if("undefined"!=typeof this.daterange){a||n(this.daterange.startDate.unix(),this.daterange.endDate.unix()),a=!1;var i=this,r=this.daterange.startDate.unix(),o=this.daterange.endDate.unix();t.delta=o-r,e.get("./json/",{params:{start:r,end:o}}).success(function(t){i.graph.series=t;var e=t[0].data.pop();i.updateStats(e.x,e.y,e.z),i.loaded=!0,"undefined"!=typeof theme&&"undefined"!=typeof theme.onStart&&theme.onStart()})}}.bind(this),t.$watch(function(){return this.daterange}.bind(this),function(){t.loadInData()})}])}();